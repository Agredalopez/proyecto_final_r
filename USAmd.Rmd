---
title: "*Trabajo Aplicado*"
date: "`r Sys.Date()`" 
autor: "Dennier Agreda López"
output:
  rmdformats::readthedown:
    highlight: tango
    self_contained: true
    gallery: true
    code_folding: show
    lightbox : true 
    se_bookdown : true
    df_print: kable
---

```{r library,echo=FALSE, message = FALSE}
library(rmdformats)
library(jsonlite)
library(knitr)
library(dplyr)
library(ggplot2)
library(leaflet)
library(plotly)
library(RColorBrewer)
library(raster)
library(kableExtra)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T)
```

# TUTORIAL  

## REGEX  

<div style="text-align: justify">Una expresión regular, regex o regexp (a veces llamada expresión racional) es una secuencia de caracteres que definen un patrón de búsqueda. Por lo general, dichos patrones son utilizados por los algoritmos de búsqueda de cadenas para las operaciones "buscar" o "buscar y reemplazar" en las cadenas, o para la validación de entrada. Es una técnica desarrollada en informática teórica y teoría del lenguaje formal.

<div style="text-align: justify">El concepto surgió en la década de 1950 cuando el matemático estadounidense Stephen Cole Kleene formalizó la descripción de un lenguaje regular. El concepto entró en uso común con las utilidades de procesamiento de texto de Unix. Existen diferentes sintaxis para escribir expresiones regulares desde la década de 1980, una es el estándar POSIX y otra, ampliamente utilizada, la sintaxis de Perl.[^1]                                 
                                                                                                
<div style="text-align: justify">De lo navegado y encontrado, se puede citar incluso algunos vídeos bastante densos en términos de entendimiento profundo de lo que son las expresiones regulares, se pretende dar a conocer la preferencia en función a dos criterios: practicidad y detalle en explicación.  

<div style="text-align: justify">Luego de haber buceado por diferentes páginas web, con el objetivo de mejorar la conceptualización de ciertos patrones y como interrelacionar éstos, se puede decir que la peor página tutorial fue [Regular-Expressions.info](https://www.regular-expressions.info/engine.html), resulta hasta molesta entrar a cada apartado y que te pidiendo donación, además de que poco explica acerca de patrones y sobre todo no muestra ejemplos claros sobre algunas situaciones particulares. Definitivamente no logré entender lo que trataba de indicar a pesar de que tiene una interminable cantidad de apartados.

<div style="text-align: justify">Como se mencionaba al incio, los criterios a considerar eran practicidad y detalle, en efecto la página que se pasa a mencionar cubre largamente ambos criterios, en primer lugar tiene bastantes apartados, tratando así de cubrir todo tipo de patrones posibles, además de ir agregando combinaciones de los mismos (que es básicamente como uno lo tiene que aplicar en el mundo laboral), todo ello implica que vaya desde un nivel básico por cada patrón, hasta un término avanzado en tipos de patrones. La página descrita lleva el nombre de [RexEgg](https://www.rexegg.com/regex-capture.html).
                                                                                                
## MARKDOWN  

<div style="text-align: justify">Markdown es un lenguaje de marcado ligero con sintaxis de formato de texto sin formato. Su diseño le permite convertirse a muchos formatos de salida, pero la herramienta original con el mismo nombre solo admite HTML. Markdown se usa a menudo para formatear archivos `Readme`, para escribir mensajes en foros de discusión en línea y para crear texto enriquecido utilizando un editor de texto sin formato.
                                                                                                
<div style="text-align: justify">Para remarcar que, la descripción inicial de Markdown contenía ambigüedades y preguntas sin respuesta, las implementaciones que aparecieron a lo largo de los años tienen diferencias sutiles y muchas vienen con extensiones de sintaxis.[^2]

<div style="text-align: justify">Abordando propiamente la finalidad del presente apartado se menciona que la opinión respecto a qué página es mejor o peor en términos de apoyo a un iniciado o entusiasta curioso de nuevos conocimientos, se indica que el criterio de selección está alineado únicamente a `Markdown`, es decir que queda de lado de análisis `RMarkdown`, que si bien es un formato en el cual también es posible de desarrollar la intención es tener claridad de lo que consiste este tipo de lenguaje a sentido general y no de manera explícita en alguna aplicación particular.

<div style="text-align: justify">Dicho lo anterior, se remarca como la peor página de las revisadas, que sirven o buscan servir de apoyo, a la llamada [MarkDown Tutorial](https://www.markdowntutorial.com/es/lesson/1/), la razón es principalmente, porque a pesar de que tiene una intención de que aprendas con la práctica (dentro de sus apartados tiene ejercicios), resulta siendo extremandamente básica y hasta cierto punto aburrida, de ahí que los ejercicios te resulten sosos de hacer.

<div style="text-align: justify">En el otro extremo, tenemos a la mejor (bajo el criterio del autor), es un blog que tiene el nombre de [Joe Di Castro](https://joedicastro.com/pages/markdown.html), lo que me resultó relavante para definir como la más idónea para poder aprender o hacer consultas rápidas de `Markdown`, fue que tiene un índice general que me llevan al punto que le indique, esto me permite dirigirme directamente a lo que necesito consultar y/o aprender. Adicional a ello, es que no solo me menciona un ejemplo sino presenta opciones alternas, lo cual le da un valor agregado que no encontré en otras páginas.

<div style="text-align: justify">Finalmente, se hace una mención honrrosa del siguiente blog: [Daring Fireball](https://daringfireball.net/projects/markdown/syntax) que pertenece John Gruber autor de `Markdown`.

# ESTADOS UNIDOS

## DESCRIPCIÓN

<div style="text-align: justify">Es la economía nacional más grande del mundo en términos nominales, con un PIB estimado en 15,7 billones de dólares (una cuarta parte del PIB global nominal) y una quinta parte del PIB global en paridad de poder adquisitivo. El país es la principal fuerza capitalista del planeta, además de ser líder en la investigación científica y la innovación tecnológica desde el siglo xix y, desde comienzos del siglo xx, el principal país industrial.[^3]

<div style="text-align: justify">Para el desarrollo del presente trabajo se hará uso de información socio-demográfica de Estados Unidos tomados de la API [DATA Usa](https://datausa.io/) y otras fuentes anexas, como los archivos precargados de `state dataset` que almacena información de los 50 estados de Estados Unidos (EE.UU), como también la de información de coordenadas poligonales de `GADM, de raster`. 


### Mapa de EE.UU


```{r map, echo=FALSE, warning=FALSE, message=FALSE}
url_inc<-"http://datausa.io/api/data?Geography=01000US:children&measure=Household Income by Race,Household Income by Race Moe&drilldowns=Race"
income <- readLines(url_inc)
income_usa <- jsonlite::fromJSON(income)[[1]]
income_usa_tot<-income_usa[c(2,4:5,7:8)]

url<-"https://datausa.io/api/data?drilldowns=State&measures=Population"
usa <- readLines(url)
tab_popusa <- jsonlite::fromJSON(usa)[[1]]
tab_popusa<-tab_popusa[,c(1:3,5)]

tmp_names<-c("state_id","state","year_id","pop")
colnames(tab_popusa)<-tmp_names

states.usa<-cbind.data.frame(state.division,state.region,state.name,state.abb,state.area)
tmp_names<-c("region","division","state","abb","area_miles")
colnames(states.usa)<-tmp_names
mile_km_sq<-2.58999
states.usa<-states.usa %>% mutate(area_kms=area_miles*mile_km_sq)

tab_usa_total<-merge(tab_popusa,states.usa)
tab_usa_total<-tab_usa_total %>% mutate(density=pop/area_kms)
tab_usa_total_div<-tab_usa_total %>%
  group_by(year_id,division) %>%
  summarize(pop_mean=mean(pop),pop_median=median(pop),pop_agg=sum(pop),area_agg=sum(area_kms))%>%
  mutate(densi_agg=pop_agg/area_agg,percent=pop_agg/sum(pop_agg)) %>% 
  ungroup() %>% 
  arrange(year_id,desc(densi_agg))
tab_2017<- tab_usa_total %>% filter(year_id==2017) %>% dplyr::select(state,density)
columbia<-c("District of Columbia",3977)
tab_2017<-rbind(tab_2017,columbia)
tab_2017<-tab_2017[order(tab_2017$state),]
usa <- getData("GADM", country="USA", level=1) 
usa$density<-as.numeric(as.character(tab_2017$density))
polygon_popup <- paste0("<strong>Name: </strong>", usa$NAME_1, "<br>",
                        "<strong>Densidad: </strong>", round(usa$density,2),"<br>")

pal <- colorQuantile("Greens", NULL, n = 5)

map = leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-98.35, 39.7,
          zoom = 2) %>% 
  addPolygons(data = usa, 
              fillColor= ~pal(density),
              fillOpacity = 0.4, 
              weight = 2, 
              color = "green",
              popup = polygon_popup)%>% 
  addControl("Estados Unidos",position = "topleft",className = "map-title") %>% 
  addMarkers(lng = -98.35, lat=39.7)

map

```  

<div style="text-align: justify">El mapa previo resalta los 50 estados  y el distrito de Columbia del país en análisis, es decir Estados Unidos de América.

## PANORAMA GENERAL

<div style="text-align: justify">En términos generales podemos resumir lo siguiente respescto a EE.UU, la población total al 2017 es más de 325 millones, su área total en kilómetros cuadrados alcanza los 9.4 millones, la densidad promedio alcanza los 34.7 personas por kilómetro cuadrado, además de ingreso mediano por familia es al 2017 60 mil dólares al año, que representa 4.7% más que el año anterior, el estado con mayor población es California y el que tiene mayor densidad es New Jersey, mientras que los estados del Sur son los más poblados, los de Noreste tienen la mayor densidad promedio por kilómetro cuadrado. En los 5 años que representa la muestra tomada, no hay cambios significativos en los datos mostrados, se muestran algunos gráficos para apoyar lo que se describirá en los acápites más adelante. Por el ado de los ingresos, el Distrito de Columbia tiene el mayor ingreso mediano con más de 80 mil dólares al año, mientras en el otro extremo se tiene a West Virginia con poco más de 43 mil.

### Tabla N°1: Descriptivo de la Población por Zona

```{r tabla_div,echo=FALSE, fig.align="center"}

knitr::kable(tab_usa_total_div) %>%
  kable_styling() %>%
  row_spec(seq(1,20,by=4), bold = F, color = "white", background = "red") %>% 
  scroll_box(width = "100%", height = "250px")
```  
                                                                                                
<div style="text-align: justify">La tabla anterior muestra los estadísticos más relevantes acerca de la información tanto de densidad, área y población de EE.UU por zona geográfica (Noreste, Sur, Central-Norte y Este), entre los años 2013 y 2017. De esta primera vista, a nivel zona geográfica podemos resumir que, el Sur tiene mayor peso poblacional del total, con un 37% del total, mientras que el NorCentral es que tiene menor representatividad con un 21%. Existen diferencias sustanciales entre los valores medios y medianos de cada zona, lo cual indica que existe mucha polarización en la distribuciones de las poblaciones, esto se aplica en todas excepto NorCentral, igualmente esto no puede ser concluyente porque estamos hablando de 50 estados y en cada zona a lo mucho habrá 14 o 15 estados lo cual resulta una muestra pequeña para sacar conclusiones certeras, ergo de lo visto muestra diferencias sustanciales entre estados de la misma zona.

## GRÁFICAS Y DESCRIPTIVOS                                                                                                
### Relación Densidad-Población, por Zona
                                                                                                
```{r p, echo=FALSE, warning=FALSE, message=FALSE}
tab_2017<-(tab_usa_total) %>% filter(year_id==2017) %>% mutate(density=round(density,2))
p <- plot_ly(tab_2017,x = ~pop, y = ~density,
             text = ~paste("Estado: ", state, '<br>Densidad:', density),
             color = ~division, colors="Dark2", size = ~density) %>% 
    layout(
         xaxis = list(title = "Población"),
         yaxis = list(title = "Densidad por Km2")) 
p
```

<div style="text-align: justify">Del gráfico anterior podemos sacar algunos datos interesantes (con base al último año disponible, 2017), como por ejemplo que si bien California es el estado con mayor población, su densidad poblacional por kilómetro cuadrado es de 39, poco más del promedio de EE.UU que está alrededor del 33 personas. En el otro extremo tenemos que New Jersey tiene la mayor densidad por kilómetro cuadrado de más de 440 personas, y con una población de 9 millones, adicionalmente se muestra que en general los estados del Noreste tienen una densidad promedio por encima del resto de zonas, visiblemente se pueden apreciar: Massachusetts, Rhode Island y Connecticut, todos por encima del 200 por kilómetro cuadrado.

### Dispersión de la densidad Zona, vista histórica

```{r s, echo=FALSE, warning=FALSE, message=FALSE, fig.align="center"}


s<-ggplot(data = tab_usa_total) +
  geom_point(mapping = aes(x = year_id  , y = density, color=division)) +
  theme (axis.text.x = element_text(angle=90)) +
  facet_wrap(region~.)+
  scale_color_brewer(palette = "Dark2")+
  labs(x="Año",
       y="Densidad por km2")
s 
```
                                                                                                
<div style="text-align: justify">El gráfico previo busca darnos a entender que en los 5 años de muestra la situación ha sido muy similar en niveles de densidad, eso es entendible porque las poblaciones no cambian abruptamente en un periodo de tiempo tan corto, asimismo nos indica que la dispersión de la zona Noreste, si bien tiene la densidad más alta en términos promedios, existe mucha dispersión los estados que los conforman, de hecho está conformada por dos regiones que tienen comportamientos muy similares, tanto Midle Atlantic como New Englad están bastante polarizadas pero en torno a diferente media, es decir tienen un grupo de estados con densidad alta y otro con niveles bajo, no se encuentran valores cercanos a la media, esto hace que la varianza sea más alta incluso.

### Distribución de Ingresos de los Estados por año

```{r inc, echo=FALSE, message=FALSE, warning=FALSE}
t<-ggplot(data=income_usa_tot, aes(`Household Income by Race`/1000)) + 
  geom_histogram(aes(y =..density..), 
                 col="blue", 
                 fill="green", 
                 alpha = .2) + 
  geom_density(col=1) + 
  labs(x="Ingresos en miles", y="Densidad")+
  facet_wrap(`ID Year`~.)
t
```

<div style="text-align: justify">El gráfico de histogramas previo muestra como son los ingresos medianos por hogar de cada estado de EE.UU en el periodo 2013 al 2017. En general tiene una distribución muy similar a una normal, recuédese que ha sido estandarizado para que se pueda mostrar en una misma escala (sumatoria del área del gráfico de densidad sea 1).

### Tabla N°2: Los Estados con más y menos ingresos medianos 

```{r tabla_agrup,echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
url_inc<-"http://datausa.io/api/data?Geography=01000US:children&measure=Household Income by Race,Household Income by Race Moe&drilldowns=Race"
income <- readLines(url_inc)
income_usa <- jsonlite::fromJSON(income)[[1]]
income_usa_tot<-income_usa[c(1:2,4:5,7:8)]
tmp_names<-c("id_race","race","state","id_year","inc_median_house","moe_inc_med")
colnames(income_usa_tot)<-tmp_names
income_td<-income_usa_tot %>% arrange(desc(inc_median_house)) %>% filter(id_year==2017, race=="Total", state!="Puerto Rico")
income_td<-income_td[c(1:5,47:51),3:6]

knitr::kable(income_td) %>%
  kable_styling() %>%
  row_spec(seq(1,10,by=9), bold = F, color = "white", background = "red") %>% 
  scroll_box(width = "100%", height = "250px")
```  

<div style="text-align: justify">Se puede determinar que, existe diferencias sustanciales entre los ingresos del primero y el último, siendo el más alto cerca del doble que el menor, esto está asociado al tipo de trabajos que tienen y el costo de vida propiamente de cada zona, vale aclarar lo que se está analizando son ingresos nominales, es muy probable que las canastas básicas en cada estado el costo promedio sea diferente y siendo así esas diferencias podrían disminuirse en términos relativos respecto al ingreso.

### Ingresos promedio por Ascendencia

```{r bar, echo=FALSE, warning=FALSE, message=FALSE, fig.align="center"}

income_agrup<-income_usa_tot %>%filter(id_year==2017) %>%  group_by(race, id_year) %>% summarise(income_mean=mean(inc_median_house)) %>% 
  arrange(desc(id_year),desc(income_mean))%>% ungroup()

ggplot(data=income_agrup, aes(x=reorder(race,-income_mean), y=income_mean/1000)) +
    geom_bar(stat="identity")+
  theme (axis.text.x = element_text(angle=90))+
    labs(x="Linaje",
       y="Ingreso en miles de dólares")
```

<div style="text-align: justify">Otros datos interesantes a mencionar son que, en promedio los de procedencia asiática ganan más cualquiera otro tipo de linaje en EE.UU, los que ganan menos en promedio resultan ser los de casta negra, seguidos por los de ascendencia nativa americana.

[^1]: Ruslan Mitkov (2003). The Oxford Handbook of Computational Linguistics. Oxford University Press. p. 754.
[^2]: "Markdown". 2013-12-04. Archived from the original on 2004-04-02
[^3]: International Monetary Fund (2018). «United States». IMF.org (en inglés)